#!/usr/bin/env python3
"""
重建简化版数据库 - 10本小说，每本1章
"""
import sqlite3
import os

def rebuild_database():
    # 备份原数据库
    if os.path.exists('novels.db'):
        os.rename('novels.db', 'novels.db.backup')
    
    # 创建新数据库
    conn = sqlite3.connect('novels.db')
    cursor = conn.cursor()
    
    # 创建表
    cursor.execute('''
        CREATE TABLE novels (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            title TEXT NOT NULL,
            author TEXT,
            cover_url TEXT,
            description TEXT,
            rating REAL,
            source_url TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    cursor.execute('''
        CREATE TABLE chapters (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            novel_id INTEGER,
            chapter_number INTEGER,
            title TEXT,
            content TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (novel_id) REFERENCES novels (id)
        )
    ''')
    
    # 10本热门小说数据
    novels = [
        {
            'title': '诡秘之主',
            'author': '爱潜水的乌贼',
            'color': '1a1a2e',
            'description': '蒸汽与机械的浪潮中，谁能触及非凡？一段"愚者"的传奇。',
            'rating': 9.5,
            'chapter': '克莱恩·莫雷蒂是廷根市历史系的毕业生，在一次神秘事件后获得了非凡力量。他以"愚者"的身份主持塔罗会，在这个充满蒸汽与机械的世界中，探索着神秘学的真相。占卜、魔药、封印物，每一样都充满危险。守夜人的职责是对抗超凡威胁，而克莱恩必须在保持理智的同时不断变强。灰雾之上，愚者俯瞰众生，引导着塔罗会成员们揭开世界的秘密。这是一个关于成长、冒险和命运的故事，在历史与黑暗的迷雾中，克莱恩踏上了一条无法回头的道路。每一个选择都关乎生死，每一次行动都需要智慧。非凡者的宿命就是走向失控，只有通过扮演法才能消化魔药。在这个诡秘的世界里，真相永远比想象更加惊人。'
        },
        {
            'title': '全职高手',
            'author': '蝴蝶蓝',
            'color': '2c3e50',
            'description': '网游荣耀顶尖高手叶修的重返巅峰之路。',
            'rating': 9.3,
            'chapter': '叶修，荣耀职业联赛的传奇选手，被誉为"斗神"。因为俱乐部的驱逐，他不得不离开职业圈，成为一家网吧的网管。但十年的游戏经验并未消失，当荣耀第十区开服时，他以"君莫笑"的ID重新回归。千机伞，这把自制武器是他的标志，可以变化为十二种形态。在第十区，他遇到了天赋异禀的唐柔，还有包子、乔一帆等伙伴。他们组建草根战队兴欣，从网吧起步，一步步向职业圈进军。副本首杀、公会战、挑战赛，每一次战斗都是技术与策略的较量。操作、意识、配合，这是荣耀的精髓。职业圈的竞争激烈而残酷，但叶修用实力证明，即使从零开始，他依然是那个"斗神"。'
        },
        {
            'title': '斗罗大陆',
            'author': '唐家三少',
            'color': '8e44ad',
            'description': '唐三在武魂世界的传奇冒险。',
            'rating': 9.1,
            'chapter': '唐三，唐门弟子，因偷学内门绝学跳崖后穿越到斗罗大陆。在这个武魂的世界，他觉醒了双生武魂——蓝银草和昊天锤。从圣魂村到诺丁学院，再到史莱克学院，他遇到了小舞、戴沐白、奥斯卡等伙伴，组成史莱克七怪。武魂分为兽武魂和器武魂，通过猎杀魂兽获得魂环来提升实力。唐门暗器在这个世界同样威力巨大，配合蓝银草的控制和昊天锤的爆发，唐三在战斗中游刃有余。冰火两仪眼的仙草让史莱克七怪实力大增，全大陆高级魂师学院精英大赛上，他们创造了奇迹。海神岛的考核让唐三获得了海神传承，成为新一代海神。这是一个关于成长、友情和爱情的故事，在这个武魂的世界里，唐三用双生武魂书写着属于自己的传奇。'
        },
        {
            'title': '遮天',
            'author': '辰东',
            'color': '16a085',
            'description': '九龙拉棺，叶凡的修行传奇。',
            'rating': 9.4,
            'chapter': '泰山之巅，九具龙尸拉着青铜古棺降临，叶凡和同学们被带到了修行世界。在北斗星域，他发现自己拥有荒古圣体，虽然被认为是废体，但他坚持修炼。轮海、道宫、四极、化龙、仙台，五大秘境步步艰辛。紫山的无始经、荒古禁地的传承，每一次机缘都伴随着生死危机。摇光圣地、姬家、姜家，各大势力虎视眈眈。叶凡在夹缝中求生存，凭借圣体和智慧，一次次化险为夷。大帝传承、古皇墓穴、成仙路，这个世界的秘密超出想象。黑暗动乱威胁着人族，只有证道成帝才能守护苍生。叶凡一路披荆斩棘，从一个普通大学生成长为盖世强者。登天路，踏歌行，弹指遮天！这是一个关于坚持、奋斗和守护的故事。'
        },
        {
            'title': '雪中悍刀行',
            'author': '烽火戏诸侯',
            'color': '34495e',
            'description': '北凉世子徐凤年的江湖与庙堂之路。',
            'rating': 9.2,
            'chapter': '徐凤年，北凉王徐骁之子，表面纨绔，实则在父亲安排下徒步江湖三年。江湖是一张珠帘，大人物小人物是珠子，大故事小故事是串线。他遇到了老剑神李淳罡、姜泥、鱼幼薇、青鸟等人，见识了天下武林高手。剑仙王仙芝天下第一，武帝城城主武道至尊，每一个都是传奇。北凉三十万铁骑横扫天下，但朝廷削藩、北境异族入侵，内忧外患。徐凤年接任北凉王，以刀开路，守护北凉百姓。北凉刀，饮过无数敌人鲜血。悍刀行，是北凉的道路，也是徐凤年的人生。江湖与庙堂，武功与谋略，侠义与家国，这是一个关于责任、情义和传承的故事。天下熙熙皆为利来，天下攘攘皆为利往，但有些人，守的是心中的道义。'
        },
        {
            'title': '斗破苍穹',
            'author': '天蚕土豆',
            'color': 'e74c3c',
            'description': '萧炎的逆袭之路，三十年河东三十年河西。',
            'rating': 9.0,
            'chapter': '萧炎，天才少年，十岁拥有九段斗之气，然而三年后突然倒退，沦为废物。戒指中的药老改变了他的命运，封印的斗之气被解开，重新开始修炼。斗气大陆，以斗气修炼，从斗者到斗帝，九个大境界。云岚宗的三年之约，萧炎发誓要变强。异火，天地间最强大的火焰，药老需要异火重塑肉身。萧炎踏上寻找异火之路，炼制丹药提升实力。从乌坦城到加玛帝国，从黑角域到中州，萧炎一路成长。他遇到了萧薰儿、纳兰嫣然、美杜莎女王等人，经历了无数战斗。三十年河东三十年河西，莫欺少年穷！这句话成为萧炎的写照。最终，他成为斗帝，守护家族，守护大陆。这是一个关于奋斗、复仇和成长的热血故事。'
        },
        {
            'title': '凡人修仙传',
            'author': '忘语',
            'color': '2ecc71',
            'description': '韩立从凡人到修仙的艰辛历程。',
            'rating': 9.3,
            'chapter': '韩立，墨土镇韩家村的普通少年，为了改变命运加入七玄门。然而他只是杂役弟子，资质平庸。偶然得到神秘小瓶，可以催熟灵药，这成为他修仙的根本。从炼气期到筑基期，每一步都艰难无比。七玄门的明争暗斗，修仙界的弱肉强食，韩立小心翼翼地生存。他没有强大的背景，没有惊人的天赋，只有谨慎的性格和不懈的努力。血色试炼、禁地探险、门派大战，韩立经历了无数生死。结丹、元婴、化神，境界不断提升。从天南到乱星海，从灵界到仙界，韩立的修仙之路越走越远。这是一个关于普通人如何在修仙界生存的故事，没有主角光环，只有智慧与坚持。凡人修仙，当如是！'
        },
        {
            'title': '鬼吹灯',
            'author': '天下霸唱',
            'color': '9b59b6',
            'description': '胡八一的摸金校尉传奇。',
            'rating': 8.8,
            'chapter': '胡八一，退伍军人，祖传《十六字阴阳风水秘术》，是摸金校尉的传承。和胖子王凯旋一起，开始了倒斗生涯。精绝古城、龙岭迷窟、云南虫谷、昆仑神宫，每一处古墓都充满凶险。粽子、机关、诅咒，稍有不慎就是死路一条。摸金校尉的规矩：鸡鸣灯灭不摸金。点上蜡烛，如果熄灭就要立即撤退。风水、八卦、奇门遁甲，这些古老的知识在墓中都能派上用场。Shirley杨，来自美国的华裔女孩，也加入了他们的队伍。她寻找父亲的踪迹，也想解开家族的诅咒。一次次探险，一次次惊险，胡八一用智慧和勇气化解危机。这是一个关于探险、悬疑和人性的故事，在黑暗的古墓中，寻找着失落的文明。'
        },
        {
            'title': '盗墓笔记',
            'author': '南派三叔',
            'color': '34495e',
            'description': '吴邪的盗墓冒险，十年之约。',
            'rating': 8.9,
            'chapter': '吴邪，古董店老板的孙子，偶然卷入盗墓世界。战国帛书引出七星鲁王宫，这是一切的开始。张起灵，神秘的闷油瓶，失忆却武功高强。王胖子，吴邪的伙伴，贪财却重情义。他们组成铁三角，闯荡墓穴。海底墓、秦岭神树、云顶天宫、蛇沼鬼城，每一处都危机四伏。血尸、禁婆、尸蟞、蛇母，各种怪物防不胜防。吴家的秘密、张家的使命、终极的真相，一切都在迷雾中。青铜门后到底是什么？张起灵为什么失忆？吴邪的家族和这一切有什么关系？十年之约，长白山脚下，吴邪等待着张起灵的归来。这是一个关于友情、秘密和守候的故事，在危险的墓穴中，寻找着真相和信任。'
        },
        {
            'title': '庆余年',
            'author': '猫腻',
            'color': '16a085',
            'description': '范闲在庆国的传奇人生。',
            'rating': 9.0,
            'chapter': '范闲，带着现代记忆重生到庆国。他是私生子，却拥有超越时代的知识。五竹叔的保护，费介的教导，范闲在澹州慢慢成长。京都，权力的中心，范闲踏入了这个漩涡。监察院、鉴查院、内库，庆国的权力机构盘根错杂。庆帝、太子、二皇子、长公主，每个人都在博弈。范闲用诗词文章震惊京都，用现代知识改革内库，用武力和智慧对抗敌人。神庙的秘密，叶轻眉的遗产，五竹的真实身份，一切逐渐揭开。范闲不想卷入权力斗争，却身不由己。他想要的只是自由自在的生活，和心爱的人在一起。但在这个时代，没有人能置身事外。这是一个关于权谋、自由和人性的故事，在庆国的朝堂江湖中，范闲走出自己的路。'
        }
    ]
    
    print("=== 重建简化数据库 ===\n")
    
    for novel in novels:
        # 插入小说
        import urllib.parse
        cover_url = f"https://via.placeholder.com/300x400/{novel['color']}/ffffff.png?text={urllib.parse.quote(novel['title'])}"
        
        cursor.execute('''
            INSERT INTO novels (title, author, cover_url, description, rating, source_url)
            VALUES (?, ?, ?, ?, ?, ?)
        ''', (novel['title'], novel['author'], cover_url, novel['description'], novel['rating'], ''))
        
        novel_id = cursor.lastrowid
        
        # 插入1章内容
        cursor.execute('''
            INSERT INTO chapters (novel_id, chapter_number, title, content)
            VALUES (?, ?, ?, ?)
        ''', (novel_id, 1, '第一章', novel['chapter']))
        
        print(f"✓ {novel['title']} ({novel['author']})")
    
    conn.commit()
    conn.close()
    
    print(f"\n✓✓✓ 完成！")
    print(f"小说总数: 10本")
    print(f"章节总数: 10章 (每本1章)")

if __name__ == '__main__':
    rebuild_database()
